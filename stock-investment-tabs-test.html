<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨æŠ•è³‡åˆ†é ç³»çµ±æ¸¬è©¦</title>
    <link rel="stylesheet" href="css/stock-investment-tabs.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }
        .test-result {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #22c55e;
            background: #f0fdf4;
        }
        .test-result.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .test-result.info {
            border-left-color: #3b82f6;
            background: #f0f9ff;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª è‚¡ç¥¨æŠ•è³‡åˆ†é ç³»çµ±æ¸¬è©¦</h1>
            <p>æ¸¬è©¦åˆ†é åŠŸèƒ½å’Œæ•¸æ“šé¡¯ç¤º</p>
        </div>
        
        <div class="test-section">
            <h2>åˆ†é åŠŸèƒ½æ¸¬è©¦</h2>
            <button class="test-button" onclick="testTabSwitching()">æ¸¬è©¦åˆ†é åˆ‡æ›</button>
            <button class="test-button" onclick="testKeyboardNavigation()">æ¸¬è©¦éµç›¤å°èˆª</button>
            <button class="test-button" onclick="testDataLoading()">æ¸¬è©¦æ•¸æ“šè¼‰å…¥</button>
            <div id="tabTestResults"></div>
        </div>
        
        <div class="test-section">
            <h2>æ•¸æ“šæ ¼å¼é©—è­‰</h2>
            <button class="test-button" onclick="verifyPortfolioData()">é©—è­‰æŠ•è³‡çµ„åˆæ•¸æ“š</button>
            <button class="test-button" onclick="verifyHoldingsData()">é©—è­‰æŒè‚¡æ•¸æ“š</button>
            <button class="test-button" onclick="verifyGoalsData()">é©—è­‰ç›®æ¨™æ•¸æ“š</button>
            <div id="dataTestResults"></div>
        </div>
        
        <div class="test-section">
            <h2>éŸ¿æ‡‰å¼æ¸¬è©¦</h2>
            <button class="test-button" onclick="testMobileLayout()">æ¸¬è©¦ç§»å‹•ç«¯å¸ƒå±€</button>
            <button class="test-button" onclick="testTabletLayout()">æ¸¬è©¦å¹³æ¿å¸ƒå±€</button>
            <button class="test-button" onclick="testDesktopLayout()">æ¸¬è©¦æ¡Œé¢å¸ƒå±€</button>
            <div id="responsiveTestResults"></div>
        </div>
        
        <div class="test-section">
            <h2>æ€§èƒ½æ¸¬è©¦</h2>
            <button class="test-button" onclick="testRenderingSpeed()">æ¸¬è©¦æ¸²æŸ“é€Ÿåº¦</button>
            <button class="test-button" onclick="testMemoryUsage()">æ¸¬è©¦è¨˜æ†¶é«”ä½¿ç”¨</button>
            <div id="performanceTestResults"></div>
        </div>
    </div>

    <!-- è¼‰å…¥åˆ†é ç³»çµ± -->
    <script src="js/stock-investment-tabs.js"></script>
    
    <script>
        // é¡¯ç¤ºæ¸¬è©¦çµæœ
        function showTestResult(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = message;
            element.appendChild(resultDiv);
        }
        
        // æ¸…é™¤æ¸¬è©¦çµæœ
        function clearTestResults(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }
        
        // æ¸¬è©¦åˆ†é åˆ‡æ›
        function testTabSwitching() {
            clearTestResults('tabTestResults');
            
            if (!window.stockInvestmentTabs) {
                showTestResult('tabTestResults', 'âŒ éŒ¯èª¤ï¼šåˆ†é ç³»çµ±æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            const tabs = ['portfolio', 'holdings', 'goals', 'analysis'];
            let successCount = 0;
            
            tabs.forEach(tab => {
                try {
                    window.stockInvestmentTabs.switchTab(tab);
                    const currentTab = window.stockInvestmentTabs.getCurrentTab();
                    if (currentTab === tab) {
                        successCount++;
                        showTestResult('tabTestResults', `âœ… æˆåŠŸåˆ‡æ›åˆ° ${tab} åˆ†é `, 'success');
                    } else {
                        showTestResult('tabTestResults', `âŒ åˆ‡æ›åˆ° ${tab} åˆ†é å¤±æ•—`, 'error');
                    }
                } catch (error) {
                    showTestResult('tabTestResults', `âŒ åˆ‡æ›åˆ° ${tab} åˆ†é æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
                }
            });
            
            if (successCount === tabs.length) {
                showTestResult('tabTestResults', `ğŸ‰ æ‰€æœ‰åˆ†é åˆ‡æ›æ¸¬è©¦é€šé (${successCount}/${tabs.length})`, 'success');
            }
        }
        
        // æ¸¬è©¦éµç›¤å°èˆª
        function testKeyboardNavigation() {
            clearTestResults('tabTestResults');
            
            if (!window.stockInvestmentTabs) {
                showTestResult('tabTestResults', 'âŒ éŒ¯èª¤ï¼šåˆ†é ç³»çµ±æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            // æ¨¡æ“¬éµç›¤äº‹ä»¶
            const leftEvent = new KeyboardEvent('keydown', { key: 'ArrowLeft' });
            const rightEvent = new KeyboardEvent('keydown', { key: 'ArrowRight' });
            
            try {
                // è¨­ç½®åˆå§‹åˆ†é 
                window.stockInvestmentTabs.switchTab('holdings');
                
                // æ¸¬è©¦å‘å·¦å°èˆª
                document.dispatchEvent(leftEvent);
                const currentTab1 = window.stockInvestmentTabs.getCurrentTab();
                showTestResult('tabTestResults', `â¬…ï¸ å‘å·¦å°èˆªï¼šç•¶å‰åˆ†é  ${currentTab1}`, 'info');
                
                // æ¸¬è©¦å‘å³å°èˆª
                document.dispatchEvent(rightEvent);
                const currentTab2 = window.stockInvestmentTabs.getCurrentTab();
                showTestResult('tabTestResults', `â¡ï¸ å‘å³å°èˆªï¼šç•¶å‰åˆ†é  ${currentTab2}`, 'info');
                
                showTestResult('tabTestResults', 'âœ… éµç›¤å°èˆªæ¸¬è©¦å®Œæˆ', 'success');
            } catch (error) {
                showTestResult('tabTestResults', `âŒ éµç›¤å°èˆªæ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // æ¸¬è©¦æ•¸æ“šè¼‰å…¥
        function testDataLoading() {
            clearTestResults('tabTestResults');
            
            if (!window.stockInvestmentTabs) {
                showTestResult('tabTestResults', 'âŒ éŒ¯èª¤ï¼šåˆ†é ç³»çµ±æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                // æ¸¬è©¦æ•¸æ“šåˆ·æ–°
                window.stockInvestmentTabs.refreshData();
                showTestResult('tabTestResults', 'âœ… æ•¸æ“šåˆ·æ–°æ¸¬è©¦é€šé', 'success');
                
                // æ¸¬è©¦æ•¸æ“šè¨­ç½®
                const testData = {
                    totalValue: 2000000,
                    totalGain: 200000,
                    totalGainPercent: 11.1
                };
                
                window.stockInvestmentTabs.setData('portfolio', testData);
                showTestResult('tabTestResults', 'âœ… æ•¸æ“šè¨­ç½®æ¸¬è©¦é€šé', 'success');
                
                showTestResult('tabTestResults', 'ğŸ‰ æ‰€æœ‰æ•¸æ“šè¼‰å…¥æ¸¬è©¦é€šé', 'success');
            } catch (error) {
                showTestResult('tabTestResults', `âŒ æ•¸æ“šè¼‰å…¥æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // é©—è­‰æŠ•è³‡çµ„åˆæ•¸æ“š
        function verifyPortfolioData() {
            clearTestResults('dataTestResults');
            
            if (!window.stockInvestmentTabs || !window.stockInvestmentTabs.data.portfolio) {
                showTestResult('dataTestResults', 'âŒ æŠ•è³‡çµ„åˆæ•¸æ“šä¸å­˜åœ¨', 'error');
                return;
            }
            
            const portfolio = window.stockInvestmentTabs.data.portfolio;
            const requiredFields = ['totalValue', 'totalGain', 'totalGainPercent', 'riskLevel', 'riskScore', 'diversificationScore', 'sharpeRatio'];
            
            let missingFields = [];
            requiredFields.forEach(field => {
                if (!(field in portfolio)) {
                    missingFields.push(field);
                }
            });
            
            if (missingFields.length === 0) {
                showTestResult('dataTestResults', 'âœ… æŠ•è³‡çµ„åˆæ•¸æ“šæ ¼å¼æ­£ç¢º', 'success');
                showTestResult('dataTestResults', `ğŸ’° ç¸½å¸‚å€¼: NT$${portfolio.totalValue.toLocaleString()}`, 'info');
                showTestResult('dataTestResults', `ğŸ“Š ç¸½æç›Š: ${portfolio.totalGain >= 0 ? '+' : ''}NT$${portfolio.totalGain.toLocaleString()}`, 'info');
                showTestResult('dataTestResults', `âš ï¸ é¢¨éšªç­‰ç´š: ${portfolio.riskLevel} (${portfolio.riskScore}åˆ†)`, 'info');
                showTestResult('dataTestResults', `ğŸŒ åˆ†æ•£åº¦åˆ†æ•¸: ${portfolio.diversificationScore}åˆ†`, 'info');
                showTestResult('dataTestResults', `ğŸ“ˆ å¤æ™®æ¯”ç‡: ${portfolio.sharpeRatio}`, 'info');
            } else {
                showTestResult('dataTestResults', `âŒ æŠ•è³‡çµ„åˆæ•¸æ“šç¼ºå°‘å­—æ®µ: ${missingFields.join(', ')}`, 'error');
            }
        }
        
        // é©—è­‰æŒè‚¡æ•¸æ“š
        function verifyHoldingsData() {
            clearTestResults('dataTestResults');
            
            if (!window.stockInvestmentTabs || !window.stockInvestmentTabs.data.holdings) {
                showTestResult('dataTestResults', 'âŒ æŒè‚¡æ•¸æ“šä¸å­˜åœ¨', 'error');
                return;
            }
            
            const holdings = window.stockInvestmentTabs.data.holdings;
            
            if (!Array.isArray(holdings)) {
                showTestResult('dataTestResults', 'âŒ æŒè‚¡æ•¸æ“šä¸æ˜¯æ•¸çµ„æ ¼å¼', 'error');
                return;
            }
            
            if (holdings.length === 0) {
                showTestResult('dataTestResults', 'âš ï¸ æŒè‚¡æ•¸æ“šç‚ºç©º', 'info');
                return;
            }
            
            const requiredFields = ['symbol', 'name', 'quantity', 'costPrice', 'currentPrice', 'gain', 'gainPercent'];
            let validHoldings = 0;
            
            holdings.forEach((holding, index) => {
                const missingFields = requiredFields.filter(field => !(field in holding));
                if (missingFields.length === 0) {
                    validHoldings++;
                } else {
                    showTestResult('dataTestResults', `âŒ æŒè‚¡ ${index} ç¼ºå°‘å­—æ®µ: ${missingFields.join(', ')}`, 'error');
                }
            });
            
            if (validHoldings === holdings.length) {
                showTestResult('dataTestResults', `âœ… æ‰€æœ‰æŒè‚¡æ•¸æ“šæ ¼å¼æ­£ç¢º (${validHoldings}ç­†)`, 'success');
                holdings.forEach(holding => {
                    showTestResult('dataTestResults', `ğŸ“ˆ ${holding.symbol} ${holding.name}: ${holding.gain >= 0 ? '+' : ''}${holding.gainPercent.toFixed(1)}%`, 'info');
                });
            }
        }
        
        // é©—è­‰ç›®æ¨™æ•¸æ“š
        function verifyGoalsData() {
            clearTestResults('dataTestResults');
            
            if (!window.stockInvestmentTabs || !window.stockInvestmentTabs.data.goals) {
                showTestResult('dataTestResults', 'âŒ ç›®æ¨™æ•¸æ“šä¸å­˜åœ¨', 'error');
                return;
            }
            
            const goals = window.stockInvestmentTabs.data.goals;
            
            if (!Array.isArray(goals)) {
                showTestResult('dataTestResults', 'âŒ ç›®æ¨™æ•¸æ“šä¸æ˜¯æ•¸çµ„æ ¼å¼', 'error');
                return;
            }
            
            if (goals.length === 0) {
                showTestResult('dataTestResults', 'âš ï¸ ç›®æ¨™æ•¸æ“šç‚ºç©º', 'info');
                return;
            }
            
            const requiredFields = ['id', 'name', 'icon', 'targetAmount', 'currentAmount', 'progress', 'status', 'statusText'];
            let validGoals = 0;
            
            goals.forEach((goal, index) => {
                const missingFields = requiredFields.filter(field => !(field in goal));
                if (missingFields.length === 0) {
                    validGoals++;
                } else {
                    showTestResult('dataTestResults', `âŒ ç›®æ¨™ ${index} ç¼ºå°‘å­—æ®µ: ${missingFields.join(', ')}`, 'error');
                }
            });
            
            if (validGoals === goals.length) {
                showTestResult('dataTestResults', `âœ… æ‰€æœ‰ç›®æ¨™æ•¸æ“šæ ¼å¼æ­£ç¢º (${validGoals}ç­†)`, 'success');
                goals.forEach(goal => {
                    showTestResult('dataTestResults', `ğŸ¯ ${goal.icon} ${goal.name}: ${goal.progress}% (${goal.statusText})`, 'info');
                });
            }
        }
        
        // æ¸¬è©¦ç§»å‹•ç«¯å¸ƒå±€
        function testMobileLayout() {
            clearTestResults('responsiveTestResults');
            
            // æ¨¡æ“¬ç§»å‹•ç«¯è¦–çª—å¤§å°
            const originalWidth = window.innerWidth;
            
            // èª¿æ•´è¦–çª—å¤§å°ï¼ˆæ¨¡æ“¬ï¼‰
            showTestResult('responsiveTestResults', 'ğŸ“± æ¨¡æ“¬ç§»å‹•ç«¯å¸ƒå±€ (å¯¬åº¦ < 768px)', 'info');
            
            // æª¢æŸ¥åˆ†é å°èˆªæ˜¯å¦ç‚ºå‚ç›´å¸ƒå±€
            const tabNavigation = document.querySelector('.tab-navigation');
            if (tabNavigation) {
                const computedStyle = window.getComputedStyle(tabNavigation);
                const flexDirection = computedStyle.flexDirection;
                
                if (flexDirection === 'column') {
                    showTestResult('responsiveTestResults', 'âœ… åˆ†é å°èˆªæ­£ç¢ºåˆ‡æ›ç‚ºå‚ç›´å¸ƒå±€', 'success');
                } else {
                    showTestResult('responsiveTestResults', 'âš ï¸ åˆ†é å°èˆªä»ç‚ºæ°´å¹³å¸ƒå±€', 'info');
                }
            }
            
            showTestResult('responsiveTestResults', 'ğŸ“± ç§»å‹•ç«¯å¸ƒå±€æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        // æ¸¬è©¦å¹³æ¿å¸ƒå±€
        function testTabletLayout() {
            clearTestResults('responsiveTestResults');
            
            showTestResult('responsiveTestResults', 'ğŸ“± æ¨¡æ“¬å¹³æ¿å¸ƒå±€ (å¯¬åº¦ 768px - 1024px)', 'info');
            
            // æª¢æŸ¥æŒ‡æ¨™å¡ç‰‡ç¶²æ ¼
            const metricsGrid = document.querySelector('.report-metrics');
            if (metricsGrid) {
                const computedStyle = window.getComputedStyle(metricsGrid);
                const gridColumns = computedStyle.gridTemplateColumns;
                
                showTestResult('responsiveTestResults', `ğŸ“Š æŒ‡æ¨™ç¶²æ ¼å¸ƒå±€: ${gridColumns}`, 'info');
            }
            
            showTestResult('responsiveTestResults', 'ğŸ“± å¹³æ¿å¸ƒå±€æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        // æ¸¬è©¦æ¡Œé¢å¸ƒå±€
        function testDesktopLayout() {
            clearTestResults('responsiveTestResults');
            
            showTestResult('responsiveTestResults', 'ğŸ–¥ï¸ æ¨¡æ“¬æ¡Œé¢å¸ƒå±€ (å¯¬åº¦ > 1024px)', 'info');
            
            // æª¢æŸ¥å®¹å™¨æœ€å¤§å¯¬åº¦
            const container = document.querySelector('.container');
            if (container) {
                const computedStyle = window.getComputedStyle(container);
                const maxWidth = computedStyle.maxWidth;
                
                showTestResult('responsiveTestResults', `ğŸ–¥ï¸ å®¹å™¨æœ€å¤§å¯¬åº¦: ${maxWidth}`, 'info');
            }
            
            showTestResult('responsiveTestResults', 'ğŸ–¥ï¸ æ¡Œé¢å¸ƒå±€æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        // æ¸¬è©¦æ¸²æŸ“é€Ÿåº¦
        function testRenderingSpeed() {
            clearTestResults('performanceTestResults');
            
            const startTime = performance.now();
            
            // æ¸¬è©¦åˆ†é åˆ‡æ›é€Ÿåº¦
            const tabs = ['portfolio', 'holdings', 'goals', 'analysis'];
            tabs.forEach(tab => {
                window.stockInvestmentTabs.switchTab(tab);
            });
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            showTestResult('performanceTestResults', `â±ï¸ åˆ†é åˆ‡æ›è€—æ™‚: ${duration.toFixed(2)}ms`, 'info');
            
            if (duration < 100) {
                showTestResult('performanceTestResults', 'âœ… æ¸²æŸ“é€Ÿåº¦å„ªç§€', 'success');
            } else if (duration < 300) {
                showTestResult('performanceTestResults', 'âœ… æ¸²æŸ“é€Ÿåº¦è‰¯å¥½', 'success');
            } else {
                showTestResult('performanceTestResults', 'âš ï¸ æ¸²æŸ“é€Ÿåº¦éœ€è¦å„ªåŒ–', 'info');
            }
        }
        
        // æ¸¬è©¦è¨˜æ†¶é«”ä½¿ç”¨
        function testMemoryUsage() {
            clearTestResults('performanceTestResults');
            
            if (performance.memory) {
                const memoryInfo = performance.memory;
                const usedMemory = memoryInfo.usedJSHeapSize;
                const totalMemory = memoryInfo.totalJSHeapSize;
                const memoryUsage = (usedMemory / totalMemory * 100).toFixed(2);
                
                showTestResult('performanceTestResults', `ğŸ’¾ è¨˜æ†¶é«”ä½¿ç”¨: ${memoryUsage}%`, 'info');
                showTestResult('performanceTestResults', `ğŸ’¾ å·²ä½¿ç”¨: ${(usedMemory / 1024 / 1024).toFixed(2)}MB`, 'info');
                showTestResult('performanceTestResults', `ğŸ’¾ ç¸½è¨˜æ†¶é«”: ${(totalMemory / 1024 / 1024).toFixed(2)}MB`, 'info');
                
                if (memoryUsage < 50) {
                    showTestResult('performanceTestResults', 'âœ… è¨˜æ†¶é«”ä½¿ç”¨æ­£å¸¸', 'success');
                } else {
                    showTestResult('performanceTestResults', 'âš ï¸ è¨˜æ†¶é«”ä½¿ç”¨è¼ƒé«˜', 'info');
                }
            } else {
                showTestResult('performanceTestResults', 'âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´è¨˜æ†¶é«”ç›£æ§', 'info');
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•é‹è¡ŒåŸºæœ¬æ¸¬è©¦
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                showTestResult('tabTestResults', 'ğŸš€ é–‹å§‹è‡ªå‹•æ¸¬è©¦...', 'info');
                testTabSwitching();
            }, 1000);
        });
    </script>
</body>
</html>
